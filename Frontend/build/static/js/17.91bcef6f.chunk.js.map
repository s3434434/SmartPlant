{"version":3,"sources":["hooks/forgot_password/reset_password/reset_password.jsx"],"names":["ResetPassword","props","logOut","wideView","search","useLocation","token","URLSearchParams","get","email","useState","newPassword","confirmNewPassword","form","setForm","showStatus","setShowStatus","status","setStatus","useEffect","document","title","window","location","pathname","handleChange","e","input","target","tempForm","_","cloneDeep","name","value","className","onSubmit","preventDefault","axios","post","then","res","catch","err","errors","response","data","messages","errorMessage","undefined","Passwords","ConfirmNewPassword","htmlFor","type","required","onChange"],"mappings":"8NAMe,SAASA,EAAcC,GACpC,IAAQC,EAAqBD,EAArBC,OAAQC,EAAaF,EAAbE,SACVC,EAASC,cAAcD,OAEvBE,EAAQ,IAAIC,gBAAgBH,GAAQI,IAAI,SAC5CC,EAAQ,IAAIF,gBAAgBH,GAAQI,IAAI,SAG1C,EAAwBE,mBAAS,CAC/BD,MAAOA,EACPH,MAAOA,EACPK,YAAa,GACbC,mBAAoB,KAJtB,mBAAOC,EAAP,KAAaC,EAAb,KAMA,EAAoCJ,oBAAS,GAA7C,mBAAOK,EAAP,KAAmBC,EAAnB,KACA,EAA4BN,mBAAS,KAArC,mBAAOO,EAAP,KAAeC,EAAf,KAGAC,qBAAU,WACRC,SAASC,MAAQ,6CAEjBnB,IAEc,OAAVI,GAA4B,OAAVG,IACpBa,OAAOC,SAASC,SAAW,OAI5B,IAGH,IAAMC,EAAe,SAACC,GACpB,IAAMC,EAAQD,EAAEE,OACVC,EAAWC,IAAEC,UAAUlB,GAE7BgB,EAASF,EAAMK,MAAQL,EAAMM,MAE7BnB,EAAQe,IAoCV,OACE,oCACE,oBAAIK,UAAU,mBAAd,4BACA,uBACEA,UAAW/B,EAAW,mBAAqB,mBAC3CgC,SApCe,SAACT,GACpBA,EAAEU,iBACFlB,EAAU,kBACVF,GAAc,GAEVH,EAAKF,cAAgBE,EAAKD,mBAC5BM,EAAU,2BAEVmB,IACGC,KACC,mEACAzB,GAED0B,MAAK,SAACC,GACLlB,OAAOC,SAASC,SAAW,gCAE5BiB,OAAM,SAACC,GACN,IAAMC,EAASD,EAAIE,SAASC,KAAKC,SAC7BC,EAAe,6CAEMC,IAArBL,EAAOM,UACTF,EAAeJ,EAAOM,UAAU,QACOD,IAA9BL,EAAOO,qBAChBH,EAAeJ,EAAOO,mBAAmB,IAG3ChC,EAAU6B,OAQd,UAIE,uBAAOb,UAAU,kBAAkBiB,QAAQ,cAA3C,0BAGA,uBACEjB,UAAU,eACVF,KAAK,cACLoB,KAAK,WACLC,UAAQ,EACRpB,MAAOpB,EAAKF,YACZ2C,SAAU7B,IAEZ,uBAAOS,UAAU,uBAAuBiB,QAAQ,qBAAhD,kCAGA,uBACEjB,UAAU,eACVF,KAAK,qBACLoB,KAAK,WACLnB,MAAOpB,EAAKD,mBACZ0C,SAAU7B,IAEXV,EACC,qBAAKmB,UAAU,mBAAf,SACE,+BAAOjB,MAGT,qBAAKiB,UAAU,oBAAf,SACE,+BAAOjB,MAGX,qBACEiB,UAAW/B,EAAW,mBAAqB,wBAD7C,SAGE,wBAAQ+B,UAAU,kBAAkBkB,KAAK,SAAzC,sC","file":"static/js/17.91bcef6f.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport _ from \"lodash\";\nimport axios from \"axios\";\nimport \"./reset_password.css\";\n\nexport default function ResetPassword(props) {\n  const { logOut, wideView } = props;\n  const search = useLocation().search;\n  // Sets constants for the 'token' and 'email' URL parameters.\n  const token = new URLSearchParams(search).get(\"token\"),\n    email = new URLSearchParams(search).get(\"email\");\n\n  // State variables for the password reset form, status of the password reset request and whether that status is being shown.\n  const [form, setForm] = useState({\n    email: email,\n    token: token,\n    newPassword: \"\",\n    confirmNewPassword: \"\",\n  });\n  const [showStatus, setShowStatus] = useState(false);\n  const [status, setStatus] = useState(\"-\");\n\n  // useEffect hook that runs a single time when this component loads. Sets the title of the web page appropriately and ensures the user is logged out on the UI. A check is performed on whether the 'token' and 'email' URL parameters are set. If not, the user is returned to the root path.\n  useEffect(() => {\n    document.title = \"Reset password | Demeter - The plant meter\";\n\n    logOut();\n\n    if (token === null || email === null) {\n      window.location.pathname = \"/\";\n    }\n\n    // eslint-disable-next-line\n  }, []);\n\n  // Updates the form state variable with the appropriate input field whenever a form input field is updated.\n  const handleChange = (e) => {\n    const input = e.target;\n    const tempForm = _.cloneDeep(form);\n\n    tempForm[input.name] = input.value;\n\n    setForm(tempForm);\n  };\n\n  // Handles the submit event of the password reset form. Sets the request status appropriately, then performs a check on whether the form's 'newPassword' and 'confirmNewPassword' fields match. If not, an appropriate error message is shown.\n  // Otherwise, a POST request to the backend password reset endpoint is made. If this request is successful, the user is taken to the 'Password reset successful' page. Otherwise, an appropriate error message is shown.\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    setStatus(\"Please wait...\");\n    setShowStatus(true);\n\n    if (form.newPassword !== form.confirmNewPassword) {\n      setStatus(\"Passwords do not match.\");\n    } else {\n      axios\n        .post(\n          \"https://smart-plant.azurewebsites.net/api/Account/Password/Reset\",\n          form\n        )\n        .then((res) => {\n          window.location.pathname = \"/password-reset-successful\";\n        })\n        .catch((err) => {\n          const errors = err.response.data.messages;\n          let errorMessage = \"Server error. Please try again later.\";\n\n          if (errors.Passwords !== undefined) {\n            errorMessage = errors.Passwords[0];\n          } else if (errors.ConfirmNewPassword !== undefined) {\n            errorMessage = errors.ConfirmNewPassword[0];\n          }\n\n          setStatus(errorMessage);\n        });\n    }\n  };\n\n  return (\n    <section>\n      <h1 className=\"gold text-center\">Reset password</h1>\n      <form\n        className={wideView ? \"w-25 m-auto mt-4\" : \"m-auto mt-4 px-2\"}\n        onSubmit={handleSubmit}\n      >\n        <label className=\"form-label gold\" htmlFor=\"newPassword\">\n          New password\n        </label>\n        <input\n          className=\"form-control\"\n          name=\"newPassword\"\n          type=\"password\"\n          required\n          value={form.newPassword}\n          onChange={handleChange}\n        />\n        <label className=\"form-label gold mt-3\" htmlFor=\"confirmNewPassword\">\n          Confirm new password\n        </label>\n        <input\n          className=\"form-control\"\n          name=\"confirmNewPassword\"\n          type=\"password\"\n          value={form.confirmNewPassword}\n          onChange={handleChange}\n        />\n        {showStatus ? (\n          <div className=\"text-center mt-3\">\n            <span>{status}</span>\n          </div>\n        ) : (\n          <div className=\"hidden-field mt-3\">\n            <span>{status}</span>\n          </div>\n        )}\n        <div\n          className={wideView ? \"text-center mt-3\" : \"text-center mt-3 mb-2\"}\n        >\n          <button className=\"btn btn-primary\" type=\"submit\">\n            Reset password\n          </button>\n        </div>\n      </form>\n    </section>\n  );\n}\n"],"sourceRoot":""}