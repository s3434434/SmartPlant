(this.webpackJsonpdemeter=this.webpackJsonpdemeter||[]).push([[8],{112:function(e,t,a){},139:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return d}));var n=a(4),c=a(1),i=a(50),r=a(51),s=a(44),o=a.n(s),l=(a(112),a(0));function d(e){var t=e.getLogin,s=e.wideView,d=Object(c.lazy)((function(){return a.e(4).then(a.bind(null,63))})),m=window.location.pathname.lastIndexOf("/")+1,u=window.location.pathname.substr(m),h=Object(c.useState)(""),j=Object(n.a)(h,2),b=j[0],p=j[1],O=Object(c.useState)(!1),x=Object(n.a)(O,2),w=x[0],f=x[1],g=Object(c.useState)(!1),v=Object(n.a)(g,2),N=v[0],y=v[1],S=Object(c.useState)("-"),z=Object(n.a)(S,2),A=z[0],P=z[1],k=Object(c.useState)(!1),D=Object(n.a)(k,2),T=D[0],I=D[1],B=Object(c.useState)("-"),C=Object(n.a)(B,2),F=C[0],U=C[1],_=Object(c.useState)(""),q=Object(n.a)(_,2),E=q[0],L=q[1],R=Object(c.useState)(""),Y=Object(n.a)(R,2),J=Y[0],V=Y[1],K=Object(c.useState)(""),G=Object(n.a)(K,2),H=G[0],M=G[1],Q=Object(c.useState)(null),W=Object(n.a)(Q,2),X=W[0],Z=W[1],$=Object(c.useState)(!1),ee=Object(n.a)($,2),te=ee[0],ae=ee[1],ne=Object(c.useState)("-"),ce=Object(n.a)(ne,2),ie=ce[0],re=ce[1],se=Object(c.useState)(null),oe=Object(n.a)(se,2),le=oe[0],de=oe[1],me=Object(c.useState)(!1),ue=Object(n.a)(me,2),he=ue[0],je=ue[1],be=Object(c.useState)("-"),pe=Object(n.a)(be,2),Oe=pe[0],xe=pe[1];Object(c.useEffect)((function(){document.title="Demeter - The plant meter";var e=t();if(null!==e){var a=e.token;e.admin?(o.a.get("https://smart-plant.azurewebsites.net/api/Admin/Plants",{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){var t=!1;e.data.forEach((function(e){e.plantID===u&&(o.a.get("https://smart-plant.azurewebsites.net/api/Admin/Users",{headers:{Authorization:"Bearer ".concat(a)}}).then((function(t){var a=!1;t.data.forEach((function(t){t.id===e.userID&&(M(t.email),a=!0)})),a||(window.location.pathname="/"),document.title="".concat(e.name," | Demeter - The plant meter"),p(e.name);var n="https://d3utxwpu6rqzip.cloudfront.net/container_no_image.png";null!==e.imgurURL&&(n=e.imgurURL),Z(n),L(e.plantType),V(e.userID)})).catch((function(e){window.location.pathname="/"})),t=!0)})),t||(window.location.pathname="/")})).catch((function(e){window.location.pathname="/"})),o.a.get("https://smart-plant.azurewebsites.net/api/Admin/SensorData/".concat(u),{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){var t=e.data.sort((function(e,t){var a=new Date(e.timeStampUTC).getTime(),n=new Date(t.timeStampUTC).getTime();return a>n?-1:a<n?1:0}));de(t)})).catch((function(e){de("There was an error retrieving the sensor data. Please try again later.")}))):window.location.pathname="/"}else window.location.pathname="/"}),[]);var we=function(){xe("Please wait..."),je(!0);var e=t();if(null!==e){var a=e.token;o.a.delete("https://smart-plant.azurewebsites.net/api/Admin/Plants?plantID=".concat(u),{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){window.location.assign(document.referrer)})).catch((function(e){xe("Server error. Please try again later.")}))}else xe("You are not logged in."),setTimeout((function(){window.location.pathname="/"}),500)};return Object(l.jsx)("section",{children:null!==X?Object(l.jsxs)(l.Fragment,{children:[s?Object(l.jsx)("div",{className:"container m-0 p-0",children:Object(l.jsxs)("div",{className:"row",children:[Object(l.jsxs)("div",{className:"col-xl-2 text-center",children:[Object(l.jsx)("div",{className:he?"":"hidden-field",children:Object(l.jsx)("span",{style:{color:"white"},children:Oe})}),Object(l.jsx)("button",{className:"btn btn-primary mt-2",onClick:we,children:"Delete plant"})]}),Object(l.jsx)("div",{className:"col-xl-10"})]})}):Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:he?"text-center":"hidden-field",children:Object(l.jsx)("span",{style:{color:"white"},children:Oe})}),Object(l.jsx)("div",{className:"text-center",children:Object(l.jsx)("button",{className:"btn btn-primary mt-2",onClick:we,children:"Delete plant"})})]}),Object(l.jsxs)("form",{className:s?"m-auto":"m-auto px-2",onSubmit:function(e){e.preventDefault(),P("Please wait..."),y(!0);var a=t();if(null!==a){var n=a.token;o.a.get("https://smart-plant.azurewebsites.net/api/Admin/Plants/User/".concat(J),{headers:{Authorization:"Bearer ".concat(n)}}).then((function(e){var t=!1;e.data.forEach((function(e){e.name===b&&(t=!0)})),t?P("A plant with this name already exists for ".concat(H,".")):o.a.put("https://smart-plant.azurewebsites.net/api/Admin/Plants",{name:b,plantID:u},{headers:{Authorization:"Bearer ".concat(n)}}).then((function(e){window.location.reload()})).catch((function(e){var t=e.response.data.errors,a="Server error. Please try again later.";void 0!==t.PlantName?a=t.PlantName[0]:void 0!==t.Name?a=t.Name[0]:void 0!==t["Name Taken"]&&(a=t["Name Taken"][0]),P(a)}))})).catch((function(e){P("Server error. Please try again later.")}))}else P("You are not logged in."),setTimeout((function(){window.location.pathname="/"}),500)},children:[w?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsxs)("div",{className:s?"w-25 m-auto":"",children:[Object(l.jsx)("label",{className:"form-label gold",htmlFor:"name",children:"Name"}),Object(l.jsx)("input",{className:"form-control mb-3",name:"name",type:"text",value:b,onChange:function(e){p(e.target.value)},required:!0})]}),Object(l.jsx)("h4",{className:"text-center m-0 p-0",style:{color:"white"},children:E})]}):Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:s?"w-25 m-auto":"",children:Object(l.jsx)("div",{className:"text-end m-0 p-0",children:Object(l.jsx)(i.a,{className:"gold light-gold-hover",tabIndex:"0",icon:r.a,style:{cursor:"pointer"},onClick:function(){f(!0)},onKeyPress:function(){f(!0)}})})}),Object(l.jsx)("h1",{className:"text-center gold m-0 mb-2 p-0",children:b}),Object(l.jsx)("h4",{className:"text-center m-0 p-0",style:{color:"white"},children:E})]}),Object(l.jsx)("div",{className:N?"text-center mt-3":s?"hidden-field m-0":"hidden-field",children:Object(l.jsx)("span",{children:A})}),Object(l.jsx)("div",{className:w?"text-center my-3":s?"hidden-field m-0":"hidden-field",children:Object(l.jsx)("button",{className:"btn btn-primary",tabIndex:w?"0":"-1",type:"submit",children:"Apply change"})})]}),Object(l.jsx)("h1",{className:"text-center mb-2 p-0 gold",children:H}),Object(l.jsxs)("div",{className:"m-auto mt-5 text-center",children:[Object(l.jsx)("img",{className:"plant-image gold-border",src:X,alt:"Plant"}),Object(l.jsx)("div",{className:T?"text-center mt-3":"hidden-field",style:{color:"white"},children:Object(l.jsx)("span",{children:F})}),Object(l.jsx)("div",{className:"https://d3utxwpu6rqzip.cloudfront.net/container_no_image.png"!==X?"text-center mt-3":"hidden-field",children:Object(l.jsx)("button",{className:"btn btn-primary",tabIndex:"https://d3utxwpu6rqzip.cloudfront.net/container_no_image.png"!==X?"0":"-1",onClick:function(){U("Please wait..."),I(!0);var e=t();if(null!==e){var a=e.token;o.a.delete("https://smart-plant.azurewebsites.net/api/Admin/Plants/Image?userID=".concat(J,"&plantID=").concat(u),{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){window.location.reload()})).catch((function(e){U("Server error. Please try again later.")}))}else U("You are not logged in."),setTimeout((function(){window.location.pathname="/"}),500)},children:"Delete image"})})]}),Object(l.jsxs)("div",{className:s?"w-25 m-auto mt-4":"m-auto mt-4 px-2",children:[Object(l.jsx)("div",{className:te?"text-center mt-1":"hidden-field",children:Object(l.jsx)("span",{style:{color:"white"},children:ie})}),Object(l.jsx)("div",{className:"text-center mt-2",children:Object(l.jsx)("button",{className:"btn btn-primary",onClick:function(){re("Please wait..."),ae(!0);var e=t();if(null!==e){var a=e.token;o.a.post("https://smart-plant.azurewebsites.net/api/Admin/Plants/NewToken/".concat(J,"/").concat(u),{userID:J,plantID:u},{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){re("Arduino token regenerated.")})).catch((function(e){re("Server error. Please try again later.")}))}else re("You are not logged in."),setTimeout((function(){window.location.pathname="/"}),500)},children:"Regenerate Arduino token"})})]}),Object(l.jsx)("h3",{className:"gold text-center mt-5",children:"Sensor data"}),Object(l.jsx)(c.Suspense,{fallback:Object(l.jsx)("div",{}),children:Object(l.jsx)(d,{sensorReadings:le,admin:!0,wideView:s})})]}):Object(l.jsx)("div",{className:s?"text-center mt-3":"text-center mt-3 mb-2",style:{color:"white"},children:"Loading plant..."})})}},47:function(e,t){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(n){"object"===typeof window&&(a=window)}e.exports=a}}]);
//# sourceMappingURL=8.e93e37f3.chunk.js.map